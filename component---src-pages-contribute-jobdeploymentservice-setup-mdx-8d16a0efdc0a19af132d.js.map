{"version":3,"sources":["webpack:///./src/pages/contribute/jobdeploymentservice_setup.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","PageDescription","AnchorLinks","AnchorLink","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-contribute-jobdeploymentservice-setup-mdx-8d16a0efdc0a19af132d.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/accelerated-decision-making-with-ai/accelerated-decision-making-with-ai/Website/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst AnchorLinks = makeShortcode(\"AnchorLinks\");\nconst AnchorLink = makeShortcode(\"AnchorLink\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <PageDescription mdxType=\"PageDescription\">\n      <p>{`This service is intended to enable deployment of a job within a Kubernetes cluster. The service is deployed into the cluster where the jobs will be deployed, so it is assumed that the appropriate credentials are available.`}</p>\n      <p>{`The service itself has two endpoints, one to check if a particular job is currently running, and the other to deploy a new job given a specified json payload defining the image to be used, and the environment variables which should be injected at runtime.`}</p>\n      <p>{`To setup the job deployment service, follow the following steps:`}</p>\n      <AnchorLinks mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">Prepare the Container Image </AnchorLink> \n  <AnchorLink mdxType=\"AnchorLink\">Deploy the Kubernetes Cluster</AnchorLink> \n  \n      </AnchorLinks>\n    </PageDescription>\n    <h2>{`Prepare the Container Image(assuming IBM Container Registry)`}</h2>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><strong parentName=\"p\">{`Build the Docker image `}</strong></p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`docker build . -t us.icr.io</namespace/jobname:tag>\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><strong parentName=\"p\">{`Push the Docker image `}</strong></p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`docker push us.icr.io</namespace/jobname:tag>\n`}</code></pre>\n        <p parentName=\"li\">{`Alternatively you can use the `}<inlineCode parentName=\"p\">{`push_image.sh`}</inlineCode>{` to handle all transactions involved while pushing an image to the IBM Container registry. `}</p>\n        <p parentName=\"li\">{`You can run the script by either:`}</p>\n        <p parentName=\"li\">{`i. `}<strong parentName=\"p\">{`Providing all the environment variables inline, when running the script with the correct variables. `}</strong>{` e.g. in terminal run `}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`sh ./push_image.sh <TARGET_IBM_CLOUD_URL> <TARGET_IBM_CLOUD_REGION <TARGET_IBM_CLOUD_GROUP> <IBM_CLOUD_APIKEY> <DOCKER_SERVER> <CONTAINER_REGISTRY_NAMESPACE> <IMAGE_NAME> <IMAGE_TAG>\n`}</code></pre>\n        <p parentName=\"li\">{`ii. `}<strong parentName=\"p\">{`Creating a .env file to hold all the required environment variables. `}</strong></p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-env\",\n            \"metastring\": \"path=.env\",\n            \"path\": \".env\"\n          }}>{`# Shared variables\nDOCKER_SERVER=______\nCONTAINER_REGISTRY_NAMESPACE=______\nIMAGE_NAME=______\nIMAGE_TAG=______\n\n# Push image variables\nTARGET_IBM_CLOUD_URL=______\nTARGET_IBM_CLOUD_REGION=______\nTARGET_IBM_CLOUD_GROUP=______\nIBM_CLOUD_APIKEY=______\n\n# Configure yaml files variables\nNAME=______\nIMAGE_PULL_SECRET_NAME=______\nJOB_NAMESPACE=______\n`}</code></pre>\n        <p parentName=\"li\">{`Copy the above and save it as .env in the JobDeploymentService directory and provide all the variables. Finally, run the script by simply running `}<inlineCode parentName=\"p\">{`sh ./push_image.sh`}</inlineCode></p>\n      </li>\n    </ol>\n    <p>{`If the  image already exists in the registry, opt to pull the image instead of pushing the Docker image.\nTo pull the Docker image, execute;`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`docker pull [OPTIONS] NAME[:TAG|@DIGEST]\n`}</code></pre>\n    <h2>{`Kubernetes Cluster Deployment`}</h2>\n    <p>{`Start by generating and configuring the yaml files, by running the script `}<inlineCode parentName=\"p\">{`sh ./config_yaml_files.sh`}</inlineCode>{` if you already created the `}<inlineCode parentName=\"p\">{`.env`}</inlineCode>{` file above. `}</p>\n    <p>{`Otherwise, either create the `}<inlineCode parentName=\"p\">{`.env`}</inlineCode>{` file and supply the variables or supply the required environment variables inline when running the script.`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><strong parentName=\"p\">{`Check for the clusters `}</strong></p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kind get clusters\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><strong parentName=\"p\">{`If there are no clusters, create a new cluster with a name of your choice. `}</strong>{` i.e. admai`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kind create cluster --name admai\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><strong parentName=\"p\">{`To allow minikube to access and pull the image in the IBM container registry, create an image pull secret, update it in the `}</strong>{` `}<inlineCode parentName=\"p\">{`.env`}</inlineCode>{` `}<strong parentName=\"p\">{`file and update it in the `}</strong>{` `}<inlineCode parentName=\"p\">{`name`}</inlineCode>{` `}<strong parentName=\"p\">{`tag of the `}</strong>{` `}<inlineCode parentName=\"p\">{`k8s.py`}</inlineCode>{` `}<strong parentName=\"p\">{`file `}</strong></p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-sh\"\n          }}>{`kubectl create secret docker-registry <YOUR_SECRET_NAME> --docker-server=<YOUR_DOCKER_SERVER e.g. us.icr.io> --docker-username=iamapikey --docker-password=<YOUR_ACCOUNT_APIKEY> --docker-email=<YOUR_DOCKER_EMAIL>\n\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><strong parentName=\"p\">{`Navigate to the `}<inlineCode parentName=\"strong\">{`JobDeploymentService`}</inlineCode>{` directory `}</strong></p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`cd JobDeploymentService\n\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><strong parentName=\"p\">{`Allow the system user to access cluster resources by running; `}</strong></p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl create -f ocprbac.yaml\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><strong parentName=\"p\">{`Create a deployment by executing; `}</strong></p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl create -f ocpdeploy.yaml\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><strong parentName=\"p\">{`Create a service by executing; `}</strong></p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl create -f mkbservice.yaml\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\"><strong parentName=\"p\">{`Check whether the pod is started by running; `}</strong></p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl get pods \n`}</code></pre>\n        <p parentName=\"li\">{`If it is not started you can check more details using `}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl describe pod <pod_name>.\n`}</code></pre>\n        <p parentName=\"li\">{`If the pod is started, run `}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl port-forward service/<service_name> 7080:8080 \n`}</code></pre>\n      </li>\n    </ol>\n    <p>{`To launch JobDeployment service on a web browser at `}<inlineCode parentName=\"p\">{`http://localhost:7080/ui`}</inlineCode></p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}