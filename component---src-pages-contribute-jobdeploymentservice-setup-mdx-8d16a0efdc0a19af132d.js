(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{E4mK:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return i})),a.d(t,"default",(function(){return j}));var n=a("wx14"),r=a("zLVn"),b=(a("q1tI"),a("7ljp")),c=a("013z"),i=(a("qKvR"),{}),p=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(b.b)("div",t)}},l=p("PageDescription"),o=p("AnchorLinks"),s=p("AnchorLink"),m={_frontmatter:i},O=c.a;function j(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(b.b)(O,Object(n.a)({},m,a,{components:t,mdxType:"MDXLayout"}),Object(b.b)(l,{mdxType:"PageDescription"},Object(b.b)("p",null,"This service is intended to enable deployment of a job within a Kubernetes cluster. The service is deployed into the cluster where the jobs will be deployed, so it is assumed that the appropriate credentials are available."),Object(b.b)("p",null,"The service itself has two endpoints, one to check if a particular job is currently running, and the other to deploy a new job given a specified json payload defining the image to be used, and the environment variables which should be injected at runtime."),Object(b.b)("p",null,"To setup the job deployment service, follow the following steps:"),Object(b.b)(o,{mdxType:"AnchorLinks"},Object(b.b)(s,{mdxType:"AnchorLink"},"Prepare the Container Image "),Object(b.b)(s,{mdxType:"AnchorLink"},"Deploy the Kubernetes Cluster"))),Object(b.b)("h2",null,"Prepare the Container Image(assuming IBM Container Registry)"),Object(b.b)("ol",null,Object(b.b)("li",{parentName:"ol"},Object(b.b)("p",{parentName:"li"},Object(b.b)("strong",{parentName:"p"},"Build the Docker image ")),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"docker build . -t us.icr.io</namespace/jobname:tag>\n"))),Object(b.b)("li",{parentName:"ol"},Object(b.b)("p",{parentName:"li"},Object(b.b)("strong",{parentName:"p"},"Push the Docker image ")),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"docker push us.icr.io</namespace/jobname:tag>\n")),Object(b.b)("p",{parentName:"li"},"Alternatively you can use the ",Object(b.b)("inlineCode",{parentName:"p"},"push_image.sh")," to handle all transactions involved while pushing an image to the IBM Container registry. "),Object(b.b)("p",{parentName:"li"},"You can run the script by either:"),Object(b.b)("p",{parentName:"li"},"i. ",Object(b.b)("strong",{parentName:"p"},"Providing all the environment variables inline, when running the script with the correct variables. ")," e.g. in terminal run "),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sh ./push_image.sh <TARGET_IBM_CLOUD_URL> <TARGET_IBM_CLOUD_REGION <TARGET_IBM_CLOUD_GROUP> <IBM_CLOUD_APIKEY> <DOCKER_SERVER> <CONTAINER_REGISTRY_NAMESPACE> <IMAGE_NAME> <IMAGE_TAG>\n")),Object(b.b)("p",{parentName:"li"},"ii. ",Object(b.b)("strong",{parentName:"p"},"Creating a .env file to hold all the required environment variables. ")),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-env",metastring:"path=.env",path:".env"}),"# Shared variables\nDOCKER_SERVER=______\nCONTAINER_REGISTRY_NAMESPACE=______\nIMAGE_NAME=______\nIMAGE_TAG=______\n\n# Push image variables\nTARGET_IBM_CLOUD_URL=______\nTARGET_IBM_CLOUD_REGION=______\nTARGET_IBM_CLOUD_GROUP=______\nIBM_CLOUD_APIKEY=______\n\n# Configure yaml files variables\nNAME=______\nIMAGE_PULL_SECRET_NAME=______\nJOB_NAMESPACE=______\n")),Object(b.b)("p",{parentName:"li"},"Copy the above and save it as .env in the JobDeploymentService directory and provide all the variables. Finally, run the script by simply running ",Object(b.b)("inlineCode",{parentName:"p"},"sh ./push_image.sh")))),Object(b.b)("p",null,"If the  image already exists in the registry, opt to pull the image instead of pushing the Docker image.\nTo pull the Docker image, execute;"),Object(b.b)("pre",null,Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"docker pull [OPTIONS] NAME[:TAG|@DIGEST]\n")),Object(b.b)("h2",null,"Kubernetes Cluster Deployment"),Object(b.b)("p",null,"Start by generating and configuring the yaml files, by running the script ",Object(b.b)("inlineCode",{parentName:"p"},"sh ./config_yaml_files.sh")," if you already created the ",Object(b.b)("inlineCode",{parentName:"p"},".env")," file above. "),Object(b.b)("p",null,"Otherwise, either create the ",Object(b.b)("inlineCode",{parentName:"p"},".env")," file and supply the variables or supply the required environment variables inline when running the script."),Object(b.b)("ol",null,Object(b.b)("li",{parentName:"ol"},Object(b.b)("p",{parentName:"li"},Object(b.b)("strong",{parentName:"p"},"Check for the clusters ")),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"kind get clusters\n"))),Object(b.b)("li",{parentName:"ol"},Object(b.b)("p",{parentName:"li"},Object(b.b)("strong",{parentName:"p"},"If there are no clusters, create a new cluster with a name of your choice. ")," i.e. admai"),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"kind create cluster --name admai\n"))),Object(b.b)("li",{parentName:"ol"},Object(b.b)("p",{parentName:"li"},Object(b.b)("strong",{parentName:"p"},"To allow minikube to access and pull the image in the IBM container registry, create an image pull secret, update it in the ")," ",Object(b.b)("inlineCode",{parentName:"p"},".env")," ",Object(b.b)("strong",{parentName:"p"},"file and update it in the ")," ",Object(b.b)("inlineCode",{parentName:"p"},"name")," ",Object(b.b)("strong",{parentName:"p"},"tag of the ")," ",Object(b.b)("inlineCode",{parentName:"p"},"k8s.py")," ",Object(b.b)("strong",{parentName:"p"},"file ")),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"kubectl create secret docker-registry <YOUR_SECRET_NAME> --docker-server=<YOUR_DOCKER_SERVER e.g. us.icr.io> --docker-username=iamapikey --docker-password=<YOUR_ACCOUNT_APIKEY> --docker-email=<YOUR_DOCKER_EMAIL>\n\n"))),Object(b.b)("li",{parentName:"ol"},Object(b.b)("p",{parentName:"li"},Object(b.b)("strong",{parentName:"p"},"Navigate to the ",Object(b.b)("inlineCode",{parentName:"strong"},"JobDeploymentService")," directory ")),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"cd JobDeploymentService\n\n"))),Object(b.b)("li",{parentName:"ol"},Object(b.b)("p",{parentName:"li"},Object(b.b)("strong",{parentName:"p"},"Allow the system user to access cluster resources by running; ")),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"kubectl create -f ocprbac.yaml\n"))),Object(b.b)("li",{parentName:"ol"},Object(b.b)("p",{parentName:"li"},Object(b.b)("strong",{parentName:"p"},"Create a deployment by executing; ")),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"kubectl create -f ocpdeploy.yaml\n"))),Object(b.b)("li",{parentName:"ol"},Object(b.b)("p",{parentName:"li"},Object(b.b)("strong",{parentName:"p"},"Create a service by executing; ")),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"kubectl create -f mkbservice.yaml\n"))),Object(b.b)("li",{parentName:"ol"},Object(b.b)("p",{parentName:"li"},Object(b.b)("strong",{parentName:"p"},"Check whether the pod is started by running; ")),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"kubectl get pods \n")),Object(b.b)("p",{parentName:"li"},"If it is not started you can check more details using "),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"kubectl describe pod <pod_name>.\n")),Object(b.b)("p",{parentName:"li"},"If the pod is started, run "),Object(b.b)("pre",{parentName:"li"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"kubectl port-forward service/<service_name> 7080:8080 \n")))),Object(b.b)("p",null,"To launch JobDeployment service on a web browser at ",Object(b.b)("inlineCode",{parentName:"p"},"http://localhost:7080/ui")))}j.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-contribute-jobdeploymentservice-setup-mdx-8d16a0efdc0a19af132d.js.map